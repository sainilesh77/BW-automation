pipeline {
   agent any

   tools {
    nodejs "Node18"
    }

   stages {
       stage('Dependencies') {
           steps {
               sh 'npm i --force'
           }
       }
      stage('Test 1') {
            steps {
                sh 'npm run cy:uat'
            }
       }
       stage('Deploy') {
           steps {
               echo 'Deploying....'
           }
       }
       stage('Email Report') {
    // Change the recipent address
        sh "zip -r allure-report.zip allure-report"
        def mailRecipients = "nilesh.softronet@gmail.com"
        env.ForEmailPlugin = env.WORKSPACE
        if(fileExists('allure-report.zip')){
          emailext(
            to: "${mailRecipients}",
            from: "nilesh.softronet@gmail.com",
            subject: "Allure Report",
            body: "PFA",
            attachmentsPattern: 'allure-report.zip'
        )
          } else{
          echo("COULD NOT FIND FILE TO ATTACH")
          }
      }
   }
}